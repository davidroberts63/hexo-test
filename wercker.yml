box: node
dev:
  steps:
    - npm-install

# Build definition
build:
  # The steps that will be executed on build
  steps:
    - script:
        code: |
          export CIRCLE_ARTIFACTS=${WERCKER_OUTPUT_DIR}/screenshots
          git submodule sync
          git submodule update --init
          npm install -g hexo-cli
          npm install -g phantomjs
          npm install
          hexo server &
          sleep 2
          phantomjs ./screenshots.js
    - tcnksm/zip:
        input: ${WERCKER_OUTPUT_DIR}/screenshots
        output: ${WERCKER_OUTPUT_DIR}/sitescreenshots
deploy:
  steps:
    - tcnksm/ghr:
        token: $GITHUB_TOKEN
        input: sitescreenshots
        version: v0.1.0         # Relase tag default is `pre-release`
        pre_release: true       # Relase as pre-release default is false
        replace: true           # Replace release if it exists
